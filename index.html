<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fabmo Fence</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
  </head>
  <body>
    <script src="js/lib/jquery.js"></script>
    <script src="js/lib/bootstrap.min.js"></script>
    <script src="js/lib/fabmo.js"></script>
    <script src="js/saw.js"></script>

    <script type="text/javascript">
    </script>
    <div class="container">
      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li class="active"><a href="#tab-manualControl" role="tab" data-toggle="tab">Manual Control</a></li>
        <li><a href="#tab-settings" role="tab" data-toggle="tab">Settings</a></li>
        <!--<li><a href="#tab-listControl" role="tab" data-toggle="tab">List Control</a></li>
        <li><a href="#tab-autoControl" role="tab" data-toggle="tab">Auto Control</a></li>
        <li><a href="#tab-parts" role="tab" data-toggle="tab">Parts</a></li>-->
      </ul>


      <div class="tab-content">
        <!-- Control Pane -->

        <div class="tab-pane active" id="tab-manualControl">
          <div class="container">
          <div class="row">
            <div class="col col-xs-6">
            <h3>Current Length</h3>
              <p></p>
              <p>
              <form class="form-inline" id="form-nav">
                <div class="form-group">
                  <div class="input-group">
                      <!-- <span class="input-group-addon">X</span> -->
                      <input type="text" class="form-control num-input" id="ctrl-xdisplay" value="????" readonly>
                  </div>
                </div>
                </form>
              </p>
              </p>

            <p>Enter the length of the cut</p>

              <p>
              <form class="form-inline" id="form-nav">
                <div class="form-group">
                  <div class="input-group">
                      <!-- <span class="input-group-addon">X</span> -->
                      <input type="text" class="form-control num-input" id="ctrl-xinput" readonly>
                  </div>
                </div>
              </form>
              </p>
              <button id="ctrl-movetool" class="btn-moveTool">Move Tool</button>
              </p>
              </p>

              <button data-id="1" class="btn-keypad">1</button>
              <button data-id="2" class="btn-keypad">2</button>
              <button data-id="3" class="btn-keypad">3</button>
              <p></p>
              <button data-id="4" class="btn-keypad">4</button>
              <button data-id="5" class="btn-keypad">5</button>
              <button data-id="6" class="btn-keypad">6</button>
              <p></p>
              <button data-id="7" class="btn-keypad">7</button>
              <button data-id="8" class="btn-keypad">8</button>
              <button data-id="9" class="btn-keypad">9</button>
              <p></p>
              <button data-id="0" class="btn-keypad">0</button>
              <button data-id="." class="btn-keypad">.</button>
              <button id="back-space" class="btn-backspace">X</button>

            </div> <!-- col -->
            <div class="col col-xs-6">
              <h3>Saw Selection:</h3>
              <button  id="ctrl-aluminum" class="btn-saw aluminum">Aluminum</button>
              <button  id="ctrl-steel" class="btn-saw steel">Steel</button>
              <hr/>
              <button  id="ctrl-home" class="btn-home">Home Tool</button>
            </div> <!-- col -->
          </div> <!-- row -->
        </div> <!-- container -->
      </div> <!-- tab pane -->


        <div class="tab-pane" id="tab-listControl">
            <h2>List Selection of parts</h2>

            <h3>Current Length</h3>
              <p></p>
              <p>
              <form class="form-inline" id="form-nav2">
                <div class="form-group">
                  <div class="input-group">
                      <!-- <span class="input-group-addon">X</span> -->
                      <input type="text" class="form-control num-input" id="ctrl-xdisplay2" value="????" readonly>
                  </div>
                </div>
                </form>
              </p>
              </p>

              <form>
                <select id="part-list" class="part-input" autocomplet="off">
						<!--<option value="part" selected disabled>Select Part</option>-->
                </select>
              </form>
              </p>
              <button id="nav-list" class="btn-moveTool ready">Move Tool</button>
              </p>
              </p>
          <!--  <script src="js/dashboard.js"></script> -->
				<canvas id="myCanvas" class="form-group"></canvas>
        </div>

         <div class="tab-pane" id="tab-autoControl">
            <h2>List Selection of parts with multiple parts cut from the same stick of material</h2>

            <p>This page will contain a pull-down list of known parts. This list will contain a part number, description and length of the part. There will also be options for cutting multiple parts out of the same stick of material. The stop will move to the proper length once the GO button is pressed and initiate the cutting cycle, move to the next length and cut again until the material is exhausted. An image of the cross section of the material to be cut is one requested feature that will most likely be added.</p>

        </div>

		<div class="tab-pane" id="tab-parts">

			<div id="part-list2"></div>
			<div class="input-group">
				<p>
				<input type="file" id="load-json" value="LOAD" onchange="startRead()"/>
				<p>
				<input type="submit" id="download-json" value="DOWNLOAD" onclick="download()"/>
				<a href="#" id="download-link"></a>
				<p>
				<input type="submit" id="delete-json" value="CLEAR" onclick="clearAll()"/>
			</div>
		</div>

    <div class="tab-pane" id="tab-settings" style="padding: 20px">
      <form class="form-horizontal" id="form-settings">
        <div class="form-group">
          <label for="job-input-cx" class="col-sm-3 control-label">Aluminum Offset: </label>
          <div class="col-sm-9">
            <div class="input-group has-success">
              <input class="form-control num-input" id="ctrl-settings-aluminum-offset" value="0.0">
              <span class="input-group-addon">in</span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="job-input-cy" class="col-sm-3 control-label">Steel Offset:</label>
          <div class="col-sm-9">
            <div class="input-group has-success">
              <input class="form-control num-input" id="ctrl-settings-steel-offset" value="0.0">
              <span class="input-group-addon">in</span>
            </div>
          </div>
        </div>
      </form>
		</div>

      </div> <!-- tab content -->
    </div><!-- container -->
    <script
    <script type="text/javascript">

		//TODO
		//

		var partList
		var part //selected part obj
		var myConfig = {}

    // Prevent a stray enter key from inadvertently submitting a form (and setting the tool in motion!)
    $(document).ready(function() {
      var fabmo = new FabMoDashboard();
      var app = new ChopSawApp(fabmo);

      $(window).keydown(function(event){
        if(event.keyCode == 13) {
          event.preventDefault();
          return false;
        }
      });

      app.init();

/*
			loadDefault();

			fabmo.getAppConfig(function(err, config) {
  				if(config != null){
  					partList=myConfig.parts;
  					clearAll();
  					loadParts();
            loadSettings();
  				}
			 }); */
    });
/*
		function loadDefault(){
			jQuery.getJSON("json/parts.json", function(json) {
				partList = json
			})
			.done(function() {
				//console.log(partList)
				loadParts();
			})

		}

		function draw(){


			c = document.getElementById("myCanvas")
			ctx = c.getContext("2d")

				for(i=0;i<partList.part.length;i++){
					for(j=0;j<partList.part[i].list.length;j++){
						if((document.getElementById("part-list").value)==(partList.part[i].list[j].partNo)){
							part=partList.part[i].list[j]
						}
					}
				}
			//console.log(part)
			ctx.canvas.width = parseInt(part.len*5)+250//$(window).innerWidth()-300
			ctx.canvas.height = 200

			ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height)
			//
			ctx.font = "12px Arial"
			ctx.fillStyle="#666"
			ctx.fillText( "TOP",8,18)
			ctx.fillText( "END",(part.len*5)+48,18)

			ctx.lineWidth="2"
			ctx.strokeStyle="#ddd"
			ctx.moveTo(parseFloat(part.len*5)+40,0)
			ctx.lineTo(parseFloat(part.len*5)+40,ctx.canvas.height)
			ctx.stroke()

			ctx.beginPath()
			ctx.fillStyle="#ddd"
			ctx.strokeStyle="#333"
			ctx.lineWidth="1"
			ctx.rect(20,ctx.canvas.height/2-(part.width*2.5),parseFloat(part.len*5),part.width*5)
			ctx.rect((part.len*5)+140,ctx.canvas.height/2-(part.width*2.5),parseFloat(part.height*5),part.width*5)
			ctx.fill()
			ctx.stroke()

			ctx.font = "16px Arial"
			ctx.fillStyle="#ff0000"
			var len = (parseFloat(part.len)).toFixed(3) + "\""
			ctx.fillText( len,parseInt(part.len*2.5),(ctx.canvas.height/2)+80)
			ctx.fillText( (parseFloat(part.height)).toFixed(3) + "\"",parseInt(part.len*5+130),(ctx.canvas.height/2)+80)
			ctx.fillText( (parseFloat(part.width)).toFixed(3) + "\"",parseInt(part.len*5+195),(ctx.canvas.height/2)+8)

			//dim lines
			ctx.lineWidth="0.7"
			ctx.strokeStyle="#ff0000"

			ctx.beginPath()
			ctx.moveTo(20,(ctx.canvas.height/2)+50)
			ctx.lineTo(20,(ctx.canvas.height/2)+55)
			ctx.lineTo((part.len*5)+20,(ctx.canvas.height/2)+55)
			ctx.lineTo((part.len*5)+20,(ctx.canvas.height/2)+50)

			ctx.moveTo((part.len*5)+140,(ctx.canvas.height/2)+50)
			ctx.lineTo((part.len*5)+140,(ctx.canvas.height/2)+55)
			ctx.lineTo((part.len*5)+140+(part.height*5),(ctx.canvas.height/2)+55)
			ctx.lineTo((part.len*5)+140+(part.height*5),(ctx.canvas.height/2)+50)

			ctx.moveTo((part.len*5)+180,(ctx.canvas.height/2)+(part.width*2.5))
			ctx.lineTo((part.len*5)+185,(ctx.canvas.height/2)+(part.width*2.5))
			ctx.lineTo((part.len*5)+185,(ctx.canvas.height/2)-(part.width*2.5))
			ctx.lineTo((part.len*5)+180,(ctx.canvas.height/2)-(part.width*2.5))

			ctx.stroke()

		}

		$( "#part-list" ).change(function() {
  			draw();
		});

		$(window).resize(function(){
			draw()
		})

		window.onload = function(){
			setTimeout("draw();", 1000);
		};

function clearAll(){
	$("#part-list").empty()
	$("#part-list2").empty()
}

function startRead(){
	clearAll()
	var file = document.getElementById('load-json').files[0];
	if(file){
		getAsText(file)
	}
}

function getAsText(readFile){
	var reader

	try{
		reader = new FileReader()
	}

	catch(e){
		console.log("Error: seems File API is not supported on your browser")
		return;
	  }
  reader.readAsText(readFile, "UTF-8")
  reader.onload = loaded;
  reader.onerror = errorHandler;
}

function loaded(e){
	fileString = JSON.parse(e.target.result);
	partList=fileString
	loadParts()
}

function errorHandler(e)
{
  if(e.target.error.code == e.target.error.NOT_READABLE_ERR)
	{
		console.log("Error reading file...")
  }
}

function loadParts(){
	myConfig = partList
	fabmo.setAppConfig(myConfig)
	for(i=0;i<partList.part.length;i++){
		var option = "<option value=\"" + partList.part[i].type + "\" disabled>" + partList.part[i].type + ":</option>"
		$("#part-list").append(option)
		$("#part-list2").append("<b>" + partList.part[i].type + "</b><br>")

		for(j=0;j<partList.part[i].list.length;j++){
			option = "<option value=\"" + partList.part[i].list[j].partNo + "\">" + partList.part[i].list[j].partNo + " " + partList.part[i].list[j].name +"</option>"
			$("#part-list").append(option)
			$("#part-list2").append("&emsp;" + partList.part[i].list[j].partNo + " " + partList.part[i].list[j].name + " - " + partList.part[i].list[j].len + "x" + partList.part[i].list[j].width + "x" + partList.part[i].list[j].height + "\"<br>")
		}
	}
	draw()
}

function download(){
	var jsonStr = JSON.stringify(partList ,null ,2)
	var link = document.getElementById("download-link")
	link.setAttribute("href", "data:text/plain;base64," + btoa(jsonStr))
	link.setAttribute("download", "partList.json")
	link.click()
}*/
    </script>
  </body>
</html>
